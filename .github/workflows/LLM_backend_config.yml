name:  Configuration Check for agent LLM Setup
on:
  push:
    branches: [ '**' ]
  pull_request:
    branches: [ '**' ]
  workflow_dispatch:

jobs:
  validate-config:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          cd backend
          pip install -r requirements.txt
      
      - name: Validate LLM configuration
        run: |
          cd backend
          python -c "
          from agents.utils.llm_config import USE_LLM, ENABLE_FALLBACK, FALLBACK_CHAIN
          print(f'✅ LLM Provider: {USE_LLM}')
          print(f'✅ Fallback Enabled: {ENABLE_FALLBACK}')
          print(f'✅ Fallback Chain: {FALLBACK_CHAIN}')
          "
      
      - name: Check for required secrets
        run: |
          echo "Checking environment configuration..."
          if [ -z "${{ secrets.GROQ_API_KEY }}" ]; then
            echo "⚠️ GROQ_API_KEY not configured (tests will use mock)"
          else
            echo "✅ GROQ_API_KEY is configured"
          fi
      
      - name: Validate database models
        run: |
          cd backend
          python -c "
          from db.models import PTOBalance, PTORequest, CompanyHoliday, CompanyBlackoutDate, HRTicket
          print('✅ All database models imported successfully')
          "
      
      - name: Check API endpoints
        run: |
          cd backend
          python -c "
          from api.pto_agent import router as pto_router
          from api.hr_ticket_agent import router as hr_router
          print(f'✅ PTO Agent has {len(pto_router.routes)} endpoints')
          print(f'✅ HR Ticket Agent has {len(hr_router.routes)} endpoints')
          "
      
      - name: Configuration summary
        if: success()
        run: echo "✅ All configurations valid on branch ${{ github.ref_name }}"