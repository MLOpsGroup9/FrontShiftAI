# Quality Gates Configuration for FrontShiftAI ML Pipeline
# Defines thresholds for model evaluation metrics across different environments

environments:
  development:
    critical:
      mean_semantic_sim:
        min: 0.40
        description: "Minimum semantic similarity between query and retrieved context"
      mean_precision_at_k:
        min: 0.70
        description: "Minimum precision at k for document retrieval"
      max_bias_gap:
        max: 0.20
        description: "Maximum allowed gap in similarity between companies"
    
    warning:
      mean_semantic_sim:
        min: 0.45
        description: "Warning threshold for semantic similarity"
      sensitivity_variance:
        max: 0.15
        description: "Maximum variance in context similarity across paraphrased queries"
      mean_precision_at_k:
        min: 0.75
        description: "Warning threshold for precision at k"
    
    performance:
      max_execution_time_seconds: 600
      max_memory_mb: 4096
      description: "Performance thresholds for pipeline execution"
    
    deployment_decision:
      require_all_critical: true
      allow_warnings: true
      description: "Deploy if all critical thresholds pass, warnings are acceptable"

  staging:
    critical:
      mean_semantic_sim:
        min: 0.45
        description: "Minimum semantic similarity between query and retrieved context"
      mean_precision_at_k:
        min: 0.80
        description: "Minimum precision at k for document retrieval"
      max_bias_gap:
        max: 0.15
        description: "Maximum allowed gap in similarity between companies"
    
    warning:
      mean_semantic_sim:
        min: 0.50
        description: "Warning threshold for semantic similarity"
      sensitivity_variance:
        max: 0.10
        description: "Maximum variance in context similarity across paraphrased queries"
      mean_precision_at_k:
        min: 0.85
        description: "Warning threshold for precision at k"
    
    performance:
      max_execution_time_seconds: 600
      max_memory_mb: 4096
      description: "Performance thresholds for pipeline execution"
    
    deployment_decision:
      require_all_critical: true
      allow_warnings: true
      description: "Deploy if all critical thresholds pass, warnings are acceptable"

  production:
    critical:
      mean_semantic_sim:
        min: 0.45
        description: "Minimum semantic similarity between query and retrieved context"
      mean_precision_at_k:
        min: 0.80
        description: "Minimum precision at k for document retrieval"
      max_bias_gap:
        max: 0.15
        description: "Maximum allowed gap in similarity between companies"
    
    warning:
      mean_semantic_sim:
        min: 0.50
        description: "Warning threshold for semantic similarity"
      sensitivity_variance:
        max: 0.10
        description: "Maximum variance in context similarity across paraphrased queries"
      mean_precision_at_k:
        min: 0.85
        description: "Warning threshold for precision at k"
    
    performance:
      max_execution_time_seconds: 600
      max_memory_mb: 4096
      description: "Performance thresholds for pipeline execution"
    
    deployment_decision:
      require_all_critical: true
      allow_warnings: false
      description: "Deploy only if all critical thresholds pass and no warnings"

# Default environment (used when environment is not specified)
default_environment: production

# Metric mapping: maps metric names from unified_summary.json to threshold keys
metric_mapping:
  mean_semantic_sim: "rag.mean_semantic_sim"
  mean_precision_at_k: "rag.mean_precision_at_k"
  max_bias_gap: "bias.max_sim_gap"
  sensitivity_variance: "sensitivity.variance"

# Quality gate result statuses
status:
  PASS: "All critical and warning thresholds passed"
  PASS_WITH_WARNINGS: "Critical thresholds passed, but warnings present"
  FAIL: "One or more critical thresholds failed"

